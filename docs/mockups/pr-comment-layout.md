## pre-production What-If Summary (non-blocking)

| Risk Assessment | Risk Level | Key Concerns |
|-----------------|------------|--------------|
| Infrastructure Drift | Medium | Existing Paris branch resources are being modified unexpectedly, and diagnostic settings show changes not in code diff. |
| PR Intent Alignment | Medium | Deployment modifies existing Paris branch resources and creates overly permissive NSG rule, beyond stated intent. |

**Summary:** Deployment adds Berlin branch infrastructure including storage account, private endpoints, and NSG rules. However, it also changes existing Paris branch resources to enable public network access and creates an overly permissive NSG rule.

<details>
<summary>üìã View changed resources (10 High Confidence)</summary>

| # | Resource | Type | Action | Risk | Summary |
|---|----------|------|--------|------|---------|
| 1 | stBerlin01 | Microsoft.Storage/storageAccounts | Create | Low | Creates storage account for Berlin branch |
| 2 | pe-stBerlin01 | Microsoft.Network/privateEndpoints | Create | Low | Creates private endpoint for Berlin storage |
| 3 | nsg-berlin-subnet | Microsoft.Network/networkSecurityGroups | Create | High | Creates NSG with overly permissive inbound rule (0.0.0.0/0:*) |
| 4 | vnet-berlin | Microsoft.Network/virtualNetworks | Create | Low | Creates virtual network for Berlin branch |
| 5 | stParis01 | Microsoft.Storage/storageAccounts | Modify | Medium | Enables public network access on existing Paris storage |
| 6 | nsg-paris-subnet | Microsoft.Network/networkSecurityGroups | Modify | Medium | Modifies existing Paris NSG rules |
| 7 | diag-stParis01 | Microsoft.Insights/diagnosticSettings | Modify | Low | Changes diagnostic log retention settings |
| 8 | pe-stParis01 | Microsoft.Network/privateEndpoints | Modify | Low | Updates private endpoint DNS configuration |
| 9 | vnet-paris | Microsoft.Network/virtualNetworks | Modify | Low | Adds new subnet for Berlin peering |
| 10 | rt-paris-default | Microsoft.Network/routeTables | Modify | Low | Adds route for Berlin branch traffic |

</details>

---

### Agent Risk Assessments

| Agent | Risk Level | Key Concerns |
|-------|------------|--------------|
| Secure Infrastructure | Low | None |
| Cost Analysis | Medium | Berlin branch adds ~$450/month in new infrastructure costs. |

<details>
<summary>üîí Secure Infrastructure Details</summary>

| Resource | Finding | Severity | Recommendation |
|----------|---------|----------|----------------|
| nsg-berlin-subnet | Inbound rule allows all traffic from 0.0.0.0/0 | High | Restrict source IP range to known CIDR blocks |
| stParis01 | Public network access being enabled | Medium | Keep public access disabled, use private endpoints |
| stBerlin01 | Storage account uses private endpoint (good) | Low | No action needed |

</details>

<details>
<summary>üí∞ Cost Analysis Details</summary>

| Resource | Estimated Monthly Cost | Finding |
|----------|----------------------|---------|
| stBerlin01 | $25 | Standard LRS storage, minimal cost |
| pe-stBerlin01 | $8 | Private endpoint hourly charge |
| vnet-berlin | $0 | No charge for VNet |
| nsg-berlin-subnet | $0 | No charge for NSG |
| Overall | ~$450 | Includes data transfer and transaction estimates |

</details>

<details>
<summary>üìÑ Raw What-If Output</summary>

```
Resource changes:
+ Microsoft.Storage/storageAccounts/stBerlin01
+ Microsoft.Network/privateEndpoints/pe-stBerlin01
+ Microsoft.Network/networkSecurityGroups/nsg-berlin-subnet
+ Microsoft.Network/virtualNetworks/vnet-berlin
~ Microsoft.Storage/storageAccounts/stParis01
~ Microsoft.Network/networkSecurityGroups/nsg-paris-subnet
~ Microsoft.Insights/diagnosticSettings/diag-stParis01
~ Microsoft.Network/privateEndpoints/pe-stParis01
~ Microsoft.Network/virtualNetworks/vnet-paris
~ Microsoft.Network/routeTables/rt-paris-default
```

</details>

### Verdict: ‚ùå UNSAFE

**Reasoning:** While the deployment successfully adds Berlin branch infrastructure, it creates security concerns through an overly permissive NSG rule and unexpectedly modifies existing Paris branch resources to enable public network access. The changes extend beyond the stated PR intent.

---

*Generated by [bicep-whatif-advisor](https://github.com/neilpeterson/bicep-whatif-advisor)*
